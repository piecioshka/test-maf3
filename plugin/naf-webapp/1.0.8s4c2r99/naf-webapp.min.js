// Copyright 1999-2012 SeaChange International
// All Rights Reserved.
NAF.conf={debug:0,traxisip:"213.224.176.50",traxisid:"Dxxxx01",chanlocsrc:"traxis",traxisidprefix:"CpeId",traxisUrl:"",numhours:6,channelRefreshInterval:0,refreshInterval:0,refreshInterval0:1,reminderTime:1,fetchInitEventsInChunks:!0,eventsRefreshInChunks:20,eventsRefreshTimeout:200,profileRefreshInterval:3600,pretune:!0,previouspretunes:0,followingpretunes:1,codcatalog:0,searchCacheSize:10,upcPrice:!1,maxPinAttempts:3,pinRetryInterval:300,wakeuptime:120,prerecordwakeuptime:3,teletextHandling:!1,
langTimeOut:500,mediawareip:"",chanUpDownKeyHandling:!1,startChannel:"CNN",initChannel:"lastViewed",lockedChannels:[],profileAgeRating:0,enable000reload:!1,useNewRecordingManager:!0,useUnifiedMapPlayer:!0,catchUpCategory:"",catchUpChannel:0,genreData:JSON.stringify({genres:[{code:"1",name:"movie",subgenres:[]},{code:"2",name:"news",subgenres:[]},{code:"3",name:"show",subgenres:[]},{code:"4",name:"sports",subgenres:[]},{code:"5",name:"children's",subgenres:[]},{code:"6",name:"music",subgenres:[]},
{code:"7",name:"arts",subgenres:[]},{code:"8",name:"social",subgenres:[]},{code:"9",name:"education",subgenres:[]},{code:"10",name:"leisure",subgenres:[]},{code:"11",name:"special",subgenres:[]},{code:"12",name:"entertainment",subgenres:[]},{code:"13",name:"crime",subgenres:[]},{code:"14",name:"series",subgenres:[]},{code:"15",name:"adult",subgenres:[]}]}),provideDefaultSettings:!0,applications:[{id:"id1",name:"MetrologicalAppStore",shortSynopsis:"The Metrological App Store",isAdult:!1,isViewable:!0,
isEntitled:!0,url:"http://maf3.metrological.com/min.html?debug=2",type:"store"}]};
function nafCleanupConf(){NAF.conf.canned&&(NAF.conf.traxisid="");if("undefined"!==typeof window){for(var g=[],l,k=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),b=0;b<k.length;b++)l=k[b].split("="),g.push(l[0]),g[l[0]]=l[1];b=0;for(l=g.length;b<l;b++){var k=g[b].toLowerCase(),c;for(c in NAF.conf)if(k==c.toLowerCase()){k=g[g[b]];isNaN(k)?NAF.conf[c]="true"===k?!0:"false"===k?!1:k:NAF.conf[c]=parseFloat(k,10);break}}}}nafCleanupConf();nafCleanupConf=null;
NAF.utils={convertJSONDateToJSDate:function(g){var l;return"string"==typeof g&&(l=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(g))?new Date(Date.UTC(+l[1],+l[2]-1,+l[3],+l[4],+l[5],+l[6])):l},convertLocalJSONDateToLocalJSDate:function(g){var l;return"string"==typeof g&&(l=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(g))?new Date(+l[1],+l[2]-1,+l[3],+l[4],+l[5],+l[6]):l},convertJSONDateToMins:function(g){g=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(g);
return(new Date(Date.UTC(+g[1],+g[2]-1,+g[3],+g[4],+g[5],+g[6]))).getTime()/6E4},convertJSONDateToJSDateCanned:function(g){var l,k=new Date;return"string"==typeof g&&(l=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(g))?new Date(Date.UTC(+k.getUTCFullYear(),+k.getUTCMonth(),+k.getUTCDate(),+l[4],+l[5],+l[6])):l},convertJSDateToJSONDate:function(g){var l=g.getUTCMonth()+1;10>l&&(l="0"+l);var k=g.getUTCDate();10>k&&(k="0"+k);var b=g.getUTCHours();10>b&&(b="0"+b);var c=g.getUTCMinutes();
return 10>c&&(c="0"+c),g.getUTCFullYear()+"-"+l+"-"+k+"T"+b+":"+c+":00Z"},clearTimer:function(g){g&&clearTimeout(g)},encodeXML:function(g){return g.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")},throttle:function(g,l){function k(){b=null}var b,c,f;return function(){c=this;f=arguments;b||(result=g.apply(c,f),b=setTimeout(k,l))}},decimalToBinary:function(g,l){for(var k=
g,b=0,c=[];0<k;)b=k%2,k=Math.floor(k/2),c.unshift(b);k=l-c.length;if(0<k)for(b=0;k>b;b++)c.unshift(0);else if(0>k)return null;return c},Log:function(){function g(a,d){if(l&&a.rank<=q.rank){console.log((new Date).toISOString()+" "+a.text+" "+k+" "+d[0]);for(var b=1;b<d.length;b++)console.log(d[b])}}var l=!1,k="",b={text:" FATAL ",rank:0},c={text:" ERROR ",rank:1},f={text:" WARN  ",rank:2},m={text:" DEBUG ",rank:3},r={text:" TRACE ",rank:4},s={text:" INFO  ",rank:5},q=r;this.trace=function(){g(r,arguments)};
this.debug=function(){g(m,arguments)};this.info=function(){g(s,arguments)};this.warn=function(){g(f,arguments)};this.error=function(){g(c,arguments)};this.fatal=function(){g(b,arguments)};this.enable=function(){l=!0};this.disable=function(){l=!1};this.setAppName=function(a){k=a};this.setLevel=function(){return{fatal:function(){q=b},error:function(){q=c},warn:function(){q=f},debug:function(){q=m},trace:function(){q=r},info:function(){q=s}}}();this.getCurrLevel=function(){return q.rank}}};
NAF.Map=function(g,l){function k(){var a=new XMLHttpRequest,d={};d.method=arguments[0];d.id=r++;d.jsonrpc=s;for(var b={},e=1;e<arguments.length;e+=2)b[arguments[e]]=arguments[e+1];d.params=b;d=JSON.stringify(d);b="/ajax?"+encodeURI(d);"undefined"!=typeof m&&""!=m&&(b="http://"+m+b);f.debug("MAP-REQ: "+d);a.open("GET",b,!1);a.setRequestHeader("Content-Type","application/json;charset=UTF-8");a.send(null);var h;try{h=JSON.parse(a.responseText)}catch(c){h={error:c,result:-1}}return h.error?f.error("MAP-ERR: code="+
h.error.code+" message="+h.error.message):f.debug("MAP-RES: status="+a.status+" response="+a.responseText.substr(0,80)),h.result}function b(a,d,b){var e=d.callbackParams;delete d.callbackParams;var h=new XMLHttpRequest,c={};c.method=a;c.id=r++;c.jsonrpc=s;d&&"{}"!=JSON.stringify(d)&&(c.params=d);a=JSON.stringify(c);d="/ajax?"+encodeURI(a);"undefined"!=typeof m&&""!=m&&(d="http://"+m+d);f.debug("MAP-ASYNC-REQ: "+a);h.open("GET",d,!0);h.setRequestHeader("Content-Type","application/json;charset=UTF-8");
h.onreadystatechange=function(){if(4===h.readyState){var a;try{200==h.status?3>=f.getCurrLevel()?f.debug("MAP-ASYNC-RESPONSE: SUCCESS "+h.responseText.substr(0,200)):f.debug("MAP-ASYNC-RESPONSE: SUCCESS "+h.responseText):f.debug("MAP-ASYNC-RESPONSE: ERROR "+h.responseText),a=JSON.parse(h.responseText)}catch(d){a={error:d,result:-1}}a.error&&f.error("MAP-ERR: code="+a.error.code+" message="+a.error.message);b&&(a.error&&(a={error:a.error.message,result:-1}),b(a.result,e));h=e=h.onreadystatechange=
null}};h.send(null);d=a=c=null}var c,f=g.log,m=l,r=1,s="2.0",q=this;f.warn("***DEPRECATED key map in NAF.Map, moving to NAF.Model.KeyMap****\n");this.VK_EXIT=3;this.VK_BACK_SPACE=8;this.VK_ENTER=this.VK_OK=13;this.VK_KEYBOARD=16;this.VK_ACCEPT=30;this.VK_SPACE=32;this.VK_PAGE_UP=33;this.VK_PAGE_DOWN=34;this.VK_HOME=36;this.VK_LEFT=37;this.VK_UP=38;this.VK_RIGHT=39;this.VK_DOWN=40;this.VK_0=48;this.VK_1=49;this.VK_2=50;this.VK_3=51;this.VK_4=52;this.VK_5=53;this.VK_6=54;this.VK_7=55;this.VK_8=56;this.VK_9=
57;this.VK_A=65;this.VK_B=66;this.VK_C=67;this.VK_D=68;this.VK_E=69;this.VK_F=70;this.VK_G=71;this.VK_H=72;this.VK_I=73;this.VK_J=74;this.VK_K=75;this.VK_L=76;this.VK_M=77;this.VK_N=78;this.VK_O=79;this.VK_P=80;this.VK_Q=81;this.VK_R=82;this.VK_S=83;this.VK_T=84;this.VK_U=85;this.VK_V=86;this.VK_W=87;this.VK_X=88;this.VK_Y=89;this.VK_Z=90;this.VK_RED=403;this.VK_GREEN=404;this.VK_BLUE=406;this.VK_YELLOW=405;this.VK_DELETE=127;this.VK_HELP=156;this.VK_POWER=409;this.VK_CHANNEL_UP=427;this.VK_CHANNEL_DOWN=
428;this.VK_VOLUME_UP=447;this.VK_VOLUME_DOWN=448;this.VK_MUTE=449;this.VK_INFO=457;this.VK_GUIDE=458;this.VK_BACK=461;this.VK_MENU=462;this.VK_PAUSE=19;this.VK_REW=412;this.VK_STOP=413;this.VK_PLAY=415;this.VK_REC=416;this.VK_FF=417;this.VK_REW_SKIP=424;this.VK_FWD_SKIP=425;this.VK_FAV=433;this.VK_TELETEXT=459;this.VK_SUBTITLE=460;this.SetAsyncEventHandlers=function(a,d,b){c=new EventSource("/server-sent-events");c.onopen=a;c.onmessage=function(a){a:{var h;try{h=JSON.parse(a.data)}catch(c){f.error("server-sent event parsing failed, event handler not invoked."+
c);b("Invalid server-sent event");break a}"undefined"!=typeof h.method?d(h):(f.error("server-sent event is not a valid MW event, event handler not invoked."),b("Invalid server-sent event"))}};c.onerror=function(e){var h;switch(e.target.readyState){case EventSource.CONNECTING:h="Eventsource reconnecting.";break;case EventSource.CLOSED:h="Eventsource closed. Creating a new one.",setTimeout(function(){q.SetAsyncEventHandlers(a,d,b)},1E4)}b(h)}};this.VidSetAnimationParameters=function(a,d,n,e,h,c){b("VidSetAnimationParameters",
{windowId:a,bAnimate:d,duration:n,speed:speed,fps:h},c)};this.VidPretune=function(a,d,n){b("VidPreTune",{windowId:a,LocatorArray:d},n)};this.VidStopPretune=function(a,d,n){b("VidStopPreTune",{windowId:a},n)};this.VidGetCurChan=function(a){b("VidGetCurChan",{},a)};this.VidGetLastChan=function(a){b("VidGetLastChan",{},a)};this.VidGetStartChan=function(){return null};this.VidDetune=function(a){b("VidDetune",{},a)};this.VidGetChanCount=function(a){b("VidGetChanCount",{},a)};this.VidGetChannelList=function(a,
d){b("VidGetChannelList",{platform:a},d)};this.VidSetVideoWinSize=function(a,d,n,e,h,c){b("VidSetVideoWinSize",{x:a,y:d,w:n,h:e,bPIP:h},c)};this.VidEnableCC=function(a,d){b("VidSetCloseCap",{enable:a},d)};this.VidGetAvailableAudioLang=function(a){b("GetAvailableAudioLanguages",{},a)};this.VidSetPrefAudioLang=function(a,d,n,e){var h={};h.language=a;(d||""!=d)&&(h.type=d);h.callbackParams=e;b("SetAudioLanguagePreference",h,n)};this.VidGetPrefAudioLang=function(a){b("GetAudioLanguagePreference",{},a)};
this.VidSetAudioLang=function(a,d,n){var e={};e.language=a;e.callbackParams=n;b("SetAudioLanguage",e,d)};this.VidGetAudioLang=function(a){b("GetAudioLanguage",{},a)};this.VidSetResolution=function(a,d,n){b("VidSetResolution",{port:a,resolution:d},n)};this.VidGetAvailableSubtitleLang=function(a){b("GetAvailableSubtitleLanguages",{},a)};this.VidSetPrefSubtitleLang=function(a,d,n,e){var h={};h.language=a;h.type=d;h.callbackParams=e;b("SetSubtitleLanguagePreference",h,n)};this.VidGetPrefSubtitleLang=
function(a){b("GetSubtitleLanguagePreference",{},a)};this.VidGetSubtitleAvailability=function(a){b("GetSubtitleAvailability",{},a)};this.VidEnableSubtitle=function(a,d){var n={};n.enable=a;b("EnableSubtitle",n,d)};this.VidSetSubtitleLang=function(a,d,n){var e={};e.language=a;e.callbackParams=n;b("SetSubtitleLanguage",e,d)};this.VidGetSubtitleLang=function(a){b("GetSubtitleLanguage",{},a)};this.IsSubtitleEnabled=function(a){b("IsSubtitleEnabled",{},a)};this.VidSetPrefTeletextLang=function(){f.info("VidSetPrefTeletextLang(): Not yet supported.")};
this.VidGetPrefTeletextLang=function(){f.info("VidGetPrefTeletextLang(): Not yet supported.")};this.IsTeletextEnabled=function(a){b("IsTeletextEnabled",{},a)};this.EnableTeletext=function(a,d){b("EnableTeletext",{enable:a},d)};this.IsTeletextAvailable=function(a){b("IsTeletextAvailable",{},a)};this.VidSetTeletextLang=function(){f.info("VidSetTeletextLang(): Not yet supported.")};this.VidGetTeletextLang=function(){f.info("VidGetTeletextLang(): Not yet supported.")};this.VidSpeakerMute=function(a,d){b("VidSpeakerMute",
{flag:a},d)};this.VidDisplayVideoOn=function(a,d){b("VidDisplayVideoOn",{flag:a},d)};this.DlnaSetDeviceName=function(a,b){return k("MapDLNASetDeviceName","name",a,"type",b)};this.DlnaGetDeviceName=function(a){return k("MapDLNAGetDeviceName","type",a)};this.MapDLNAGetActiveDevices=function(a){return k("MapDLNAGetActiveDevices","type",a)};this.MapDLNAGetContainer=function(a,d,n,e,h,c,f,p){return p?(b("MapDLNAGetContainer",{id:a,containerId:d,containerType:n,filter:e,startAt:h,requestedCount:c,sort:f},
p),void 0):k("MapDLNAGetContainer","id",a,"containerId",d,"containerType",n,"filter",e,"startAt",h,"requestedCount",c,"sort",f)};this.MapPlayer=function(a,d,n,e,h,c,f,p,u,m,g){var r={};r.type=h;r.x=c;r.y=f;r.width=p;r.height=u;h={};g&&(h.callbackParams=g);h.ver="1.0";h.url=a;h.block=d;h.rate=n;e&&(h.playPos=e);h.window=r;b("MapPlayer",h,m)};this.MapPlayerRTSPVod=function(a,d,n,e,h,c,f,p,u,m){var g={};g.type=h;g.x=c;g.y=f;g.width=p;g.height=u;h={ver:"1.0"};h.id=a;h.block=d;h.rate=n;h.playPos=e;h.window=
g;b("MapPlayer",h,m)};this.MapPlayerStop=function(a,d,n,e,h,c){var f={};f.type=a;f.x=d;f.y=n;f.width=e;f.height=h;b("MapPlayer",{ver:"1.0",window:f},c)};this.MapPlayerSkip=function(a,d,n,e,h,c,f,p,u){var m={};m.type=e;m.x=h;m.y=c;m.width=f;m.height=p;b("MapPlayer",{ver:"1.0",url:a,rate:d,playPos:n,window:m},u)};this.MapPlayerMakePipPrimary=function(a,d){var n={ver:"1.0"};n.url=a;n.window={type:"pip"};n.destwin={type:"main"};b("MapPlayer",n,d)};this.MapPlayerSetVideoWinSize=function(a,d,n,e,h,c,f){var p=
{};p.type=d;p.x=n;p.y=e;p.width=h;p.height=c;b("MapPlayer",{ver:"1.0",url:a,window:p},f)};this.DvrSync=function(){return k("PvrSync")};this.DvrRecord=function(a,d,n,e,h,c,f,p){var m;if(0!=f){m=c?new Date(1E3*c):new Date;for(var g="",r=0;r<f.length;r++)7==f[r]?g="0,"+g:g+=f[r]+",";g=g.substring(0,g.length-1);m=m.getMinutes()+" "+m.getHours()+" * * "+g}b("PvrSchedRecording",{locator:a,channelId:d,duration:n,title:e,description:h,start:c,interval:m},p)};this.DvrRecordEvent=function(a){return console.log("DvrRecordEvent: "+
a),k("PvrSchedRecording","eventCrid",a)};this.DvrRecordSeries=function(a){return console.log("DvrRecordSeries: "+a),k("PvrSchedRecording","seriesCrid",a)};this.DvrUpdateRecord=function(a,b,c){return void 0!=b&&void 0!=c?k("PvrUpdateRecording","recordingId",a,"duration",b,"start",c):void 0!=c?(console.log("DvrUpdateRecord(): duration is null!!!"),k("PvrUpdateRecording","recordingId",a,"start",c)):void 0!=b?(console.log("DvrUpdateRecord(): startTime is null!!!"),k("PvrUpdateRecording","recordingId",
a,"duration",b)):void 0};this.DvrAssetList=function(a){b("PvrListRecording",{},a)};this.DvrListRequests=function(a){return a?(b("PvrListRequests",{},a),void 0):k("PvrListRequests")};this.DvrListOperations=function(a){return a?(b("PvrListOperations",{},a),void 0):k("PvrListOperations")};this.DvrListRecordings=function(a){return a?(b("PvrListRecordings",{},a),void 0):k("PvrListRecordings")};this.DvrListRequestsOperationsRecordings=function(a){return a?(b("PvrBatchCommand",{commands:["PvrListRequests",
"PvrListOperations","PvrListRecordings"]},a),void 0):k("PvrBatchCommand","commands",["PvrListRequests","PvrListOperations","PvrListRecordings"])};this.DvrPause=function(a){b("PvrPlayTrick",{speed:0},a)};this.DvrResume=function(a){b("PvrPlayTrick",{speed:100},a)};this.DvrFastForward=function(a,d){b("PvrPlayTrick",{speed:a},d)};this.DvrRewind=function(a,d){b("PvrPlayTrick",{speed:-a},d)};this.DvrOffset=function(a,d){b("PvrPlaySkip",{offset:a},d)};this.DvrDelete=function(a,d){b("PvrDeleteRecording",
{locator:a},d)};this.DvrDeleteRequest=function(a,d){b("PvrDelete",{requestId:a},d)};this.DvrDeleteOperation=function(a,d){b("PvrDelete",{operationId:a},d)};this.DvrDeleteRecording=function(a,d){b("PvrDelete",{recordingId:a},d)};this.DvrDeleteProtectOperation=function(a,d,c,e){var h={},h={operationId:a,protect:d};h.callbackParams=e;b("PvrDeleteProtect",h,c)};this.DvrPinProtectOperation=function(a,d,c,e){var h={},h={operationId:a,protect:d};h.callbackParams=e;b("PvrPinProtect",h,c)};this.DvrDeleteProtectRequest=
function(a,d,c,e){var h={},h={requestId:a,protect:d};h.callbackParams=e;b("PvrDeleteProtect",h,c)};this.DvrPinProtectRequest=function(a,d,c,e){var h={},h={requestId:a,protect:d};h.callbackParams=e;b("PvrPinProtect",h,c)};this.DvrStop=function(a){b("DvrStop",{},a)};this.PvrStop=function(a){b("PvrStop",{},a)};this.DvrStopRecording=function(a,d){b("PvrStopRecording",{recordingId:a},d)};this.VodSessionOpen=function(a,d,c){b("VodSessionOpen",{assetId:a,vodType:d},c)};this.VodSessionClose=function(a){b("VodSessionClose",
{},a)};this.VodPlay=function(a,d,c){b("VodPlay",{blocked:a,start:d},c)};this.VodPause=function(a){b("VodPause",{},a)};this.VodFastforward=function(a,d,c){b("VodFastforward",{numerator:a,denominator:d},c)};this.VodRewind=function(a,d,c){b("VodRewind",{numerator:a,denominator:d},c)};this.VodStop=function(a){b("VodStop",{},a)};this.VodGet=function(a,d){b("VodGet",{name:a},d)};this.VodSet=function(a,d,c){b("VodSet",{name:a,value:d},c)};this.VodPlaySkip=function(a,d){b("VodPlaySkip",{offset:a},d)};this.VodResume=
function(a){b("VodFastforward",{numerator:1,denominator:1},a)};this.ConfigGet=function(a,d){b("ConfigGet",{name:a},d)};this.ConfigSet=function(a,b){return k("ConfigSet","name",a,"value",b)};this.GetMWConfig=function(a,d,c){b("GetMWConfig",{section:a,key:d},c)};this.EmulateRemoteKey=function(a){return k("EmulateRemoteKey","KeyCode",a)};this.VerifyPin=function(a,d,c,e,h){var f={},f={profile:a,type:d,pin:c};f.callbackParams=h;b("VerifyPin",f,e)};this.ResetPin=function(a,d,c,e,h,f){var m={},m={profile:a,
type:d,masterpin:c,newpin:e};m.callbackParams=f;b("ResetPin",m,h)};this.GetPinState=function(a,d){b("GetPinState",{profile:a,type:d},callback)};this.ActivatePin=function(a,d,c,e){b("ActivatePin",{profile:a,type:d,masterpin:masterpin,activate:e},callback)};this.GetProfileNames=function(a){a()};this.ProfileSetInitChan=function(a,d,c,e){var h={};e&&(h.callbackParams=e);h.profileId=a;-1!=a.indexOf("MasterProfile")&&(h.keyword="master");h.Settings={};h.Settings.initChannel=d;b("WriteProfile",h,c)};this.ProfileGetInitChan=
function(a,d,c){var e={};c&&(e.callbackParams=c);e.profileId=a;e.Settings=["initChannel"];b("ReadProfile",e,d)};this.ProfileSetAgeRating=function(a,d,c,e){d=d?d:1001;var h={};e&&(h.callbackParams=e);h.profileId=a;-1!=a.indexOf("MasterProfile")&&(h.keyword="master");h.Settings={};h.Settings.ageRating=d;b("WriteProfile",h,c)};this.ProfileGetAgeRating=function(a,d,c){var e={};c&&(e.callbackParams=c);e.profileId=a;e.Settings=["ageRating"];b("ReadProfile",e,d)};this.ProfileSetStartupProtection=function(a,
d,c,e){var h={};e&&(h.callbackParams=e);h.profileId=a;-1!=a.indexOf("MasterProfile")&&(h.keyword="master");h.Settings={};h.Settings.startupProtection=d;b("WriteProfile",h,c)};this.ProfileGetStartupProtection=function(a,d,c){var e={};c&&(e.callbackParams=c);e.profileId=a;e.Settings=["startupProtection"];b("ReadProfile",e,d)};this.ProfileSetNeedPinForPurchase=function(a,d,c,e){var h={};e&&(h.callbackParams=e);h.profileId=a;-1!=a.indexOf("MasterProfile")&&(h.keyword="master");h.Settings={};h.Settings.needPinForPurchase=
d;b("WriteProfile",h,c)};this.ProfileGetNeedPinForPurchase=function(a,d,c){var e={};c&&(e.callbackParams=c);e.profileId=a;e.Settings=["needPinForPurchase"];b("ReadProfile",e,d)};this.SetStandbyMode=function(a,d,c,e){b("SetStandbyMode",{mode:a,time:d,callbackParams:e},c)};this.AcknowledgePowerManagerEvent=function(a){b("AcknowledgePowerManagerEvent",{},a)};this.PesGetAllEvents=function(a,d){b("GetAllEvents",{filter:a},d)};this.PesGetChannelsWithEvent=function(a,d,c,e){b("GetChannelsWithEvent",{ChanFilter:a,
ChanProps:d,EventFilter:c},e)};this.PesGetEventsByChanId=function(a,b){return k("GetEventsByChanId","chanId",a,"filter",b)};this.PesGetEventsByLcn=function(a,b){return k("GetEventsByLcn","lcn",a,"filter",b)};this.PesGetPfEventsByChanId=function(a){return k("GetPfEventsByChanId","chanId",a)};this.PesGetPfEventsByLcn=function(a){return k("GetPfEventsByLcn","lcn",a)};this.MapGetOnlineMode=function(a){b("MapGetOnlineMode",{},a)};this.writePVRProfile=function(a,d,c,e){var h={};h.callbackParams=e;h.profileId=
a;-1!=a.indexOf("MasterProfile")&&(h.keyword="master");h.Settings={};h.Settings.pvrSettings={};h.Settings.pvrSettings.frontPad=void 0!=d.newFrontPad?d.newFrontPad:d.frontPad;h.Settings.pvrSettings.backPad=void 0!=d.newBackPad?d.newBackPad:d.backPad;h.Settings.pvrSettings.seriesDomain=void 0!=d.newSeriesDomain?d.newSeriesDomain:d.seriesDomain;h.Settings.pvrSettings.diskManagement=void 0!=d.newDiskManagement?d.newDiskManagement:d.diskManagement;b("WriteProfile",h,c)};this.readPVRProfile=function(a,
d,c){var e={};c&&(e.callbackParams=c);e.profileId=a;-1!=a.indexOf("MasterProfile")&&(e.keyword="master");e.Settings=["pvrSettings"];b("ReadProfile",e,d)};this.writeViewSettingsProfile=function(a,d,c,e,h){var f={};f.callbackParams=h;f.profileId=a;-1!=a.indexOf("MasterProfile")&&(f.keyword="master");f.Settings={};f.Settings.viewSettings={};f.Settings.viewSettings.lang={};f.Settings.viewSettings.lang.code=void 0!=d.newCode?d.newCode:d.code;f.Settings.viewSettings.lang.type=void 0!=d.newType?d.newType:
d.type;f.Settings.viewSettings.transparency=void 0!=c.newTransparency?c.newTransparency:c.transparency;f.Settings.viewSettings.bannerTimeout=void 0!=c.newBannerTimeout?c.newBannerTimeout:c.bannerTimeout;f.Settings.viewSettings.epgStyle=void 0!=c.newEpgStyle?c.newEpgStyle:c.epgStyle;f.Settings.viewSettings.epgSpan=void 0!=c.newEpgSpan?c.newEpgSpan:c.epgSpan;f.Settings.viewSettings.assetsStyle=void 0!=c.newAssetsStyle?c.newAssetsStyle:c.assetsStyle;f.Settings.viewSettings.settingsProtection=void 0!=
c.newSettingsProtection?c.newSettingsProtection:c.settingsProtection;b("WriteProfile",f,e)};this.readViewSettingsProfile=function(a,d,c){var e={};c&&(e.callbackParams=c);e.profileId=a;-1!=a.indexOf("MasterProfile")&&(e.keyword="master");e.Settings=["viewSettings"];b("ReadProfile",e,d)};this.writeOutputSettingsProfile=function(a,d,c,e){var f={};f.callbackParams=e;f.profileId=a;-1!=a.indexOf("MasterProfile")&&(f.keyword="master");f.Settings={};f.Settings.outputSettings={};f.Settings.outputSettings.primary=
void 0!=d.newPrimary?d.newPrimary:d.primary;f.Settings.outputSettings.hdmi={};f.Settings.outputSettings.hdmi.resolution=void 0!=d.hdmi.newResolution?d.hdmi.newResolution:d.hdmi.resolution;f.Settings.outputSettings.hdmi.format=void 0!=d.hdmi.newFormat?d.hdmi.newFormat:d.hdmi.format;f.Settings.outputSettings.hdmi.color=void 0!=d.hdmi.newColor?d.hdmi.newColor:d.hdmi.color;f.Settings.outputSettings.hdmi.audio={};f.Settings.outputSettings.hdmi.audio.enable=void 0!=d.hdmi.audio.newEnable?d.hdmi.audio.newEnable:
d.hdmi.audio.enable;f.Settings.outputSettings.hdmi.audio.delay=void 0!=d.hdmi.audio.newDelay?d.hdmi.audio.newDelay:d.hdmi.audio.delay;f.Settings.outputSettings.spdif={};f.Settings.outputSettings.spdif.enable=void 0!=d.spdif.newEnable?d.spdif.newEnable:d.spdif.enable;f.Settings.outputSettings.spdif.delay=void 0!=d.spdif.newDelay?d.spdif.newDelay:d.spdif.delay;f.Settings.outputSettings.tv={};f.Settings.outputSettings.tv.aspectRatio=void 0!=d.tv.newAspectRatio?d.tv.newAspectRatio:d.tv.aspectRatio;f.Settings.outputSettings.tv.start=
void 0!=d.tv.newStart?d.tv.newStart:d.tv.start;f.Settings.outputSettings.scart={};f.Settings.outputSettings.scart.format=void 0!=d.scart.newFormat?d.scart.newFormat:d.scart.format;f.Settings.outputSettings.scart.color=void 0!=d.scart.newColor?d.scart.newColor:d.scart.color;f.Settings.outputSettings.scart.enable=void 0!=d.scart.newEnable?d.scart.newEnable:d.scart.enable;f.Settings.outputSettings.audio={};f.Settings.outputSettings.audio.format=void 0!=d.audio.newFormat?d.audio.newFormat:d.audio.format;
f.Settings.outputSettings.frontPanel={};f.Settings.outputSettings.frontPanel.luminosity=void 0!=d.frontPanel.newLuminosity?d.frontPanel.newLuminosity:d.frontPanel.luminosity;b("WriteProfile",f,c)};this.readOutputSettingsProfile=function(a,d,c){var e={};c&&(e.callbackParams=c);e.profileId=a;-1!=a.indexOf("MasterProfile")&&(e.keyword="master");e.Settings=["outputSettings"];b("ReadProfile",e,d)};this.VidGetTSBInfo=function(a){b("GetTSBInfo",{},a)};this.VidGetTSBEventInfo=function(a){b("GetTSBEventInfo",
{},a)};this.SubscribePlayerPosition=function(a,d){b("MAPSubscribeEvent",{name:"MWPlayerPosition",frequency:a},d)};this.UnsubscribePlayerPosition=function(a){b("MAPUnsubscribeEvent",{name:"MWPlayerPosition"},a)};this.SubscribeTSBEventInfo=function(a){b("MAPSubscribeEvent",{name:"TSBEventInfo"},a)};this.UnsubscribeTSBEventInfo=function(a){b("MAPUnsubscribeEvent",{name:"TSBEventInfo"},a)};this.AdjustUserAgeRating=function(a,d){b("AdjustUserAgeRating",{tempAgeRating:a},d)};this.RevertUserAgeRating=function(a){b("RevertUserAgeRating",
{},a)};this.GetDiagnostics=function(a){b("GetDiagnostics",{},a)};this.SendDiagMsg=function(a,b,c){k("SendTo","method","DiagResult","targetIP",b,"result",a,"message",c)};this.SendDiagResp=function(a,b,c,e){k("QueryResult","method","DiagResult","targetIP",b,"result",a,"message",c,"dqId",e)};this.GetStandbyModeSettings=function(a){b("GetStandbyModeSettings",{},a)};this.SetStandbyModeSettings=function(a,d,c,e,f,m){b("SetStandbyModeSettings",{autoStandby:a,timeout:d,startTime:c,endTime:e,weekday:f},m)};
this.GetNetworks=function(a){a()};this.HideSplashScreen=function(){};this.writePrefAudioLangs=function(a,d,c){var e={};-1!=a.indexOf("MasterProfile")&&(e.keyword="master");e.profileId=a;e.Settings={};e.Settings.prefAudioLangs={};e.Settings.prefAudioLangs=d;b("WriteProfile",e,c)};this.readPrefAudioLangs=function(a,d,c){var e={};c&&(e.callbackParams=c);-1!=a.indexOf("MasterProfile")&&(e.keyword="master");e.profileId=a;e.Settings=["prefAudioLangs"];b("ReadProfile",e,d)};this.writePrefSubtitleLangs=function(a,
c,f){var e={};-1!=a.indexOf("MasterProfile")&&(e.keyword="master");e.profileId=a;e.Settings={};e.Settings.prefSubtitleLangs={};e.Settings.prefSubtitleLangs=c;b("WriteProfile",e,f)};this.readPrefSubtitleLangs=function(a,c,f){var e={};f&&(e.callbackParams=f);-1!=a.indexOf("MasterProfile")&&(e.keyword="master");e.profileId=a;e.Settings=["prefSubtitleLangs"];b("ReadProfile",e,c)};this.writePrefTeletextLangs=function(a,c,f){var e={};-1!=a.indexOf("MasterProfile")&&(e.keyword="master");e.profileId=a;e.Settings=
{};e.Settings.prefTeletextLangs={};e.Settings.prefTeletextLangs=c;b("WriteProfile",e,f)};this.readPrefTeletextLangs=function(a,c,f){var e={};f&&(e.callbackParams=f);-1!=a.indexOf("MasterProfile")&&(e.keyword="master");e.profileId=a;e.Settings=["prefTeletextLangs"];b("ReadProfile",e,c)}};
pmrpc=self.pmrpc=function(){function g(){for(var a=[],b=0;36>b;b++)a[b]="0123456789ABCDEF"[Math.floor(16*Math.random())];a[14]="4";a[19]="89AB"[Math.floor(4*Math.random())];a[8]=a[13]=a[18]=a[23]="-";return a.join("")}function l(a,b){for(var c=a.whitelist,d=a.blacklist,f=!1,e=!1,p=0;p<c.length;++p)if(b.match(RegExp(c[p]))){f=!0;break}for(c=0;c<d.length;++c)if(b.match(RegExp(d[c]))){e=!0;break}return f&&!e}function k(a,b,c,d){if(!(c instanceof Array)){for(var f=a.toString(),e=f.substring(f.indexOf("(")+
1,f.indexOf(")")),e=""===e?[]:e.split(", "),f={},p=0;p<e.length;p++)f[e[p]]=p;var e=[],h;for(h in c)if("undefined"!==typeof f[h])e[f[h]]=c[h];else throw"No such param: "+h;c=e}"undefined"!==typeof d&&(c=c.concat(d));return a.apply(b,c)}function b(a,b,c){var d={jsonrpc:"2.0"};d.method=a;d.params=b;"undefined"!==typeof c&&(d.id=c);return d}function c(a,b,c){var d={};d.code=a;d.message=b;d.data=c;return d}function f(a,b,c){var d={jsonrpc:"2.0"};d.id=c;"undefined"===typeof a||null===a?d.result="undefined"===
b?null:b:d.error=a;return d}function m(a){if(a.publicProcedureName in u)return!1;t[a.publicProcedureName]={publicProcedureName:a.publicProcedureName,procedure:a.procedure,context:a.procedure.context,isAsync:"undefined"!==typeof a.isAsynchronous?a.isAsynchronous:!1,acl:"undefined"!==typeof a.acl?a.acl:{whitelist:["(.*)"],blacklist:[]}};return!0}function r(a){var b=a.event,c=a.source,f="undefined"!==typeof c&&null!==c;0===b.data.indexOf("pmrpc.")&&(a=JSON.parse(b.data.substring(6)),"undefined"!==typeof a.method?
(b={data:b.data,source:f?c:b.source,origin:f?"*":b.origin,shouldCheckACL:!f},a=s(a,b),null!==a&&d(b.source,a,b.origin)):q(a))}function s(a,b,e){if("2.0"!==a.jsonrpc)return f(c(-32600,"Invalid request.","The recived JSON is not a valid JSON-RPC 2.0 request."),null,null);var p=a.id;e=t[a.method];if("undefined"!==typeof e)if(!b.shouldCheckACL||l(e.acl,b.origin))try{if(e.isAsync)return k(e.procedure,e.context,a.params,[function(a){d(b.source,f(null,a,p),b.origin)},function(a){d(b.source,f(c(-1,"Application error.",
a.message),null,p),b.origin)},b]),null;var h=k(e.procedure,e.context,a.params,[b]);return"undefined"===typeof p?null:f(null,h,p)}catch(m){return"undefined"===typeof p?null:m.match("^(No such param)")?f(c(-32602,"Invalid params.",m.message),null,p):f(c(-1,"Application error.",m.message),null,p)}else return"undefined"===typeof p?null:f(c(-2,"Application error.","Access denied on server."),null,p);else return"undefined"===typeof p?null:f(c(-32601,"Method not found.","The requestd remote procedure does not exist or is not available."),
null,p)}function q(a){var b=a.id,c=p[b];if("undefined"!==typeof c&&null!==c)if(delete p[b],"undefined"===typeof a.error)c.onSuccess({destination:c.destination,publicProcedureName:c.publicProcedureName,params:c.params,status:"success",returnValue:a.result});else c.onError({destination:c.destination,publicProcedureName:c.publicProcedureName,params:c.params,status:"error",message:a.error.message+" "+a.error.data})}function a(a){if(a.retries&&0>a.retries)throw new Exception("number of retries must be 0 or higher");
var c=[];if("undefined"===typeof a.destination||null===a.destination||"workerParent"===a.destination)c=[{context:null,type:"workerParent"}];else if("publish"===a.destination)c=v().concat(w);else if(a.destination instanceof Array)for(var d=0;d<a.destination.length;d++)"workerParent"===a.destination[d]?c.push({context:null,type:"workerParent"}):"undefined"!==typeof a.destination[d].frames?c.push({context:a.destination[d],type:"window"}):c.push({context:a.destination[d],type:"worker"});else"undefined"!==
typeof a.destination.frames?c.push({context:a.destination,type:"window"}):c.push({context:a.destination,type:"worker"});for(d=0;d<c.length;d++){var e={destination:c[d].context,destinationDomain:"undefined"===typeof a.destinationDomain?["*"]:"string"===typeof a.destinationDomain?[a.destinationDomain]:a.destinationDomain,publicProcedureName:a.publicProcedureName,onSuccess:"undefined"!==typeof a.onSuccess?a.onSuccess:function(){},onError:"undefined"!==typeof a.onError?a.onError:function(){},retries:"undefined"!==
typeof a.retries?a.retries:5,timeout:"undefined"!==typeof a.timeout?a.timeout:500,status:"requestNotSent"};isNotification="undefined"===typeof a.onError&&"undefined"===typeof a.onSuccess;params="undefined"!==typeof a.params?a.params:[];callId=g();p[callId]=e;e.message=isNotification?b(a.publicProcedureName,params):b(a.publicProcedureName,params,callId);n(callId)}}function d(a,b,c){if("undefined"===typeof a||null===a)self.postMessage("pmrpc."+JSON.stringify(b));else{if("undefined"!==typeof a.frames)return a.postMessage("pmrpc."+
JSON.stringify(b),c);a.postMessage("pmrpc."+JSON.stringify(b))}}function n(b){var e=p[b];if("undefined"!==typeof e)if(-1>=e.retries)q(f(c(-4,"Application error.","Destination unavailable."),null,b));else if("requestSent"!==e.status)if(0===e.retries||"available"===e.status){e.status="requestSent";e.retries=-1;p[b]=e;for(var h=0;h<e.destinationDomain.length;h++)d(e.destination,e.message,e.destinationDomain[h],e),self.setTimeout(function(){n(b)},e.timeout)}else e.status="pinging",e.retries-=1,a({destination:e.destination,
publicProcedureName:"receivePingRequest",onSuccess:function(a){!0===a.returnValue&&"undefined"!==typeof p[b]&&(p[b].status="available",n(b))},params:[e.publicProcedureName],retries:0,destinationDomain:e.destinationDomain}),p[b]=e,self.setTimeout(function(){p[b]&&"pinging"===p[b].status&&n(b)},e.timeout/e.retries)}function e(a,b,c,d){"addEventListener"in a?a.addEventListener(b,c,d):a.attachEvent("on"+b,c)}function h(a,b,c){return function(d){a({event:d,source:b,destinationType:c})}}function v(){var a=
[];if("undefined"!==typeof window){a.push({context:window.top,type:"window"});for(var b=0;"undefined"!==typeof a[b];b++)for(var c=a[b],d=0;d<c.context.frames.length;d++)a.push({context:c.context.frames[d],type:"window"})}else a.push({context:this,type:"workerParent"});return a}if("undefined"===typeof JSON||"undefined"===typeof JSON.stringify||"undefined"===typeof JSON.parse)throw"pmrpc requires the JSON library";if("undefined"===typeof this.postMessage&&"undefined"===typeof this.onconnect)throw"pmrpc requires the HTML5 cross-document messaging and worker APIs";
var t={},p={},u={};if("window"in this){var x=h(r,null,"window");e(this,"message",x,!1)}else if("onmessage"in this)x=h(r,this,"worker"),e(this,"message",x,!1);else if("onconnect"in this)e(this,"connect",function(a){var b=h(r,a.ports[0],"sharedWorker");e(a.ports[0],"message",b,!1);a.ports[0].start()},!1);else throw"Pmrpc must be loaded within a browser window or web worker.";var y=this.Worker;this.nonPmrpcWorker=y;var z=this.SharedWorker;this.nonPmrpcSharedWorker=z;var w=[];this.Worker=function(a){a=
new y(a);w.push({context:a,type:"worker"});var b=h(r,a,"worker");e(a,"message",b,!1);return a};this.SharedWorker=function(a,b){var c=new z(a,b);w.push({context:c,type:"sharedWorker"});var d=h(r,c.port,"sharedWorker");e(c.port,"message",d,!1);c.postMessage=function(a,b){return c.port.postMessage(a,b)};c.port.start();return c};m({publicProcedureName:"receivePingRequest",procedure:function(a){return"undefined"!==typeof t[a]}});m({publicProcedureName:"getRegisteredProcedures",procedure:function(){var a=
[],b="undefined"!==typeof this.frames?window.location.protocol+"//"+window.location.host+(""!==window.location.port?":"+window.location.port:""):"",c;for(c in t)c in u||a.push({publicProcedureName:t[c].publicProcedureName,acl:t[c].acl,origin:b});return a}});u={getRegisteredProcedures:null,receivePingRequest:null};return{register:m,unregister:function(a){if(a in u)return!1;delete t[a];return!0},call:a,discover:function(a){var b=null;if("undefined"===typeof a.destination)for(var b=v().concat(w),c=0;c<
b.length;c++)b[c]=b[c].context;else b=a.destination;var d="undefined"===typeof a.originRegex?"(.*)":a.originRegex,e="undefined"===typeof a.nameRegex?"(.*)":a.nameRegex,f=b.length,p=[];pmrpc.call({destination:b,destinationDomain:"*",publicProcedureName:"getRegisteredProcedures",onSuccess:function(b){f--;var c=b.returnValue;b=b.destination;for(var h=0;h<c.length;h++)c[h].origin.match(RegExp(d))&&c[h].publicProcedureName.match(RegExp(e))&&p.push({publicProcedureName:c[h].publicProcedureName,destination:b,
procedureACL:c[h].acl,destinationOrigin:c[h].origin});0===f&&a.callback(p)},onError:function(b){f--;0===f&&a.callback(p)}})}}}();"function"==typeof define&&define.amd&&define(pmrpc);
WebApp.Controller=function(g){function l(a){e.debug("WebApp.Controller: received init reply");g.channels=a.returnValue[0];g.state.players=a.returnValue[1];g.state.applications=a.returnValue[2];g.initialized=!0;e.debug("WebApp.Controller: WebApp.model is initialized");m("model.initialized")}function k(a,b,c){var d,e;a=a[b][c];var f=g.state.applications[b][c];return d=a instanceof Object?JSON.stringify(a).substring(0,100):a,e=f instanceof Object?JSON.stringify(f).substring(0,100):f,"model.state.applications."+
b+"."+c+" changed from "+d+" to "+e}function b(a,b,c){var d,e;a=a[b][c];var f=g.state.players[b][c];return d=a instanceof Object?JSON.stringify(a).substring(0,100):a,e=f instanceof Object?JSON.stringify(f).substring(0,100):f,"model.state.players."+b+"."+c+" changed from "+d+" to "+e}function c(a,b){return!f(a,b)&&!!(null!==a&&void 0!==a||null!==b&&void 0!==b)}function f(a,b){if(a instanceof Function)return b instanceof Function?a.toString()===b.toString():!1;if(null===a||void 0===a||null===b||void 0===
b)return a===b;if(a===b||a.valueOf()===b.valueOf())return!0;if(a instanceof Date||b instanceof Date||!(a instanceof Object)||!(b instanceof Object))return!1;var c=Object.keys(a);return Object.keys(b).every(function(a){return-1!==c.indexOf(a)})?c.every(function(c){return f(a[c],b[c])}):!1}function m(a){e.debug("WebApp.Controller: notifyView('"+a+"')");try{n.emit(a,a)}catch(b){e.error("WebApp.Controller: error thrown by child webapp processing model event - "+b),b.stack&&e.error(b.stack)}}function r(a,
b,c){void 0==c&&(c=s);b.splice(0,0,window.name);e.debug("WebApp.Controller: sending pmrpc call to master controller - "+a+"("+JSON.stringify(b)+")");pmrpc.call({destination:window.top,publicProcedureName:a,params:[b],timeout:3E3,onSuccess:c,onError:q})}function s(a){e.trace("WebApp.Controller: pmrpc message ("+a.publicProcedureName+") delivery confirmed");void 0!=a.returnValue&&(e.debug("WebApp.Controller: object returned from pmrpc message send:  "+JSON.stringify(a.returnValue)),e.warn("WebApp.Controller: this return object is ignored"))}
function q(a){e.error("WebApp.Controller: pmrpc message "+a.publicProcedureName+"("+JSON.stringify(a.params)+") send FAILED");e.error("WebApp.Controller: error status info returned: "+a.message)}var a=this;g=g?g:new WebApp.Model;var d,n=new WebApp.EventEmitter({wildcard:!0}),e=new NAF.utils.Log;d=["model.channels","model.state.players","model.state.applications"];e.enable();0===NAF.conf.debug?e.setLevel.error():1===NAF.conf.debug?e.setLevel.warn():2===NAF.conf.debug?e.setLevel.debug():3===NAF.conf.debug?
e.setLevel.trace():4===NAF.conf.debug?e.setLevel.info():e.disable();this.on=function(a,b){n.on(a,b)};this.off=function(a,b){n.off(a,b)};this.init=function(){r("init",d,l)};this["do"]=function(b,c){if(b.match(/^model\.state\.applications\.\d+\.appMsg$/)&&c instanceof Object)if(void 0==c.sourceId){var d;try{d=a.getApplicationIndex(),c.sourceId=g.state.applications[d].id,e.debug("WebApp.Controller: supplying appMsg sourceId - "+c.sourceId+" for app #"+d)}catch(f){c.sourceId="unknown"}}else e.debug("WebApp.Controller: using webapp-supplied appMsg sourceId - "+
c.sourceId);c instanceof Object&&(c.serializedObjectType=c.constructor.name,e.debug("WebApp.Controller: serializing object type of do() argument and embedding type name - "+c.constructor.name));r("do",[b,c])};var h={},v=0;this.load=function(a,b){var c="load-callback-"+v++;h[c]=b;r("load",[a,c])};this.registerPMRPC=function(){pmrpc.register({publicProcedureName:"update-model",procedure:function(b){try{e.trace("WebApp.Controller: pmrpc model update message received - "+b),a.UpdateModel(b)}catch(c){e.error("WebApp.Controller: error thrown BY WEBAPP processing model update - "+
c),c.stack&&e.error(c.stack)}}});pmrpc.register({publicProcedureName:"load-callback",procedure:function(b){try{e.trace("WebApp.Controller: pmrpc load callback received - "+b),a.processLoadCallback(b)}catch(c){e.error("WebApp.Controller: error processing load callback - "+c),e.error(c.stack)}}})};this.UpdateModel=function(a){if("key"===a[0])e.debug("WebApp.Controller: key input received - "+JSON.stringify(a[1])),g.state.key=a[1],m("model.state.key");else if("application"==a[0]){var d=g.state.applications[a[1]].inFocus;
g.state.applications[a[1]].inFocus="true"==a[2];if(g.state.applications[a[1]].inFocus)if(d){for(var d=g.state.applications,f=parseInt(a[1]),h=0;h<d.length;h++)if(h!==f){var r=g.state.applications[h].inFocus;g.state.applications[h].inFocus=!1;r&&m("model.state.applications."+h)}e.debug("WebApp.Controller: focus set on app "+a[1]);m("model.state.applications."+a[1])}else e.trace("app "+a[1]+" already had focus");else e.trace("WebApp.Controller: focus unset on app "+a[1])}else if("channels"==a[0])e.debug("WebApp.Controller: channel array update received"),
g.channels=a[1];else if("applications"==a[0]){if(e.debug("WebApp.Controller: application array update received"),d=g.state.applications,g.state.applications=a[1],0!=d.length)for(a=0;a<d.length;a++)if(c(d[a].state,g.state.applications[a].state)&&(e.debug("WebApp.Controller: "+k(d,a,"state")+", notifying view"),m("model.state.applications."+a+".state")),c(d[a].appMsg,g.state.applications[a].appMsg)&&(e.debug("WebApp.Controller: "+k(d,a,"appMsg")+", notifying view"),m("model.state.applications."+a+".appMsg")),
void 0==d[a].media&&void 0!=g.state.applications[a].media){if(g.state.applications[a].media.assets&&0<g.state.applications[a].media.assets.length)for(e.debug("WebApp.Controller: app media data was created"),f=0;f<g.state.applications[a].media.assets.length;f++)m("model.state.applications."+a+".media.assets."+f)}else void 0!=d[a].media&&void 0==g.state.applications[a].media?e.debug("WebApp.Controller: app media data was either deleted"):c(d[a].media.assets,g.state.applications[a].media.assets)&&g.state.applications[a].media.assets.length>
d[a].media.assets.length&&(e.debug("WebApp.Controller: media asset list grew (from "+d[a].media.assets.length+" to "+g.state.applications[a].media.assets.length+"), notifying view"),m("model.state.applications."+a+".media.assets."+(g.state.applications[a].media.assets.length-1)))}else if("players"==a[0]){if(e.debug("WebApp.Controller: player array update received"),d=g.state.players,g.state.players=a[1],0!=d.length)for(a=0;a<d.length;a++)c(d[a].currentProgram,g.state.players[a].currentProgram)&&(e.debug("WebApp.Controller: "+
b(d,a,"currentProgram")+", notifying view"),m("model.state.players."+a+".currentProgram")),c(d[a].isBlocked,g.state.players[a].isBlocked)&&(e.debug("WebApp.Controller: "+b(d,a,"isBlocked")+", notifying view"),m("model.state.players."+a+".isBlocked")),c(d[a].playRate,g.state.players[a].playRate)&&(e.debug("WebApp.Controller: "+b(d,a,"playRate")+", notifying view"),m("model.state.players."+a+".playRate")),c(d[a].source,g.state.players[a].source)&&(e.debug("WebApp.Controller: "+b(d,a,"source")+", notifying view"),
m("model.state.players."+a+".source")),c(d[a].status,g.state.players[a].status)&&(e.debug("WebApp.Controller: "+b(d,a,"status")+", notifying view"),m("model.state.players."+a+".status")),c(d[a].position,g.state.players[a].position)&&(e.debug("WebApp.Controller: "+b(d,a,"position")+", notifying view"),m("model.state.players."+a+".position")),c(d[a].availAudioLangs,g.state.players[a].availAudioLangs)&&(e.debug("WebApp.Controller: "+b(d,a,"availAudioLangs")+", notifying view"),m("model.state.players."+
a+".availAudioLangs")),c(d[a].audioLang,g.state.players[a].audioLang)&&(e.debug("WebApp.Controller: "+b(d,a,"audioLang")+", notifying view"),m("model.state.players."+a+".audioLang")),c(d[a].availSubtitleLangs,g.state.players[a].availSubtitleLangs)&&(e.debug("WebApp.Controller: "+b(d,a,"availSubtitleLangs")+", notifying view"),m("model.state.players."+a+".availSubtitleLangs")),c(d[a].subtitleLang,g.state.players[a].subtitleLang)?(e.debug("WebApp.Controller: "+b(d,a,"subtitleLang")+", notifying view"),
m("model.state.players."+a+".subtitleLang")):c(d[a].subtitleLang.enable,g.state.players[a].subtitleLang.enable)&&(e.debug("WebApp.Controller: model.state.players."+a+".subtitleLang.enable changed from "+d[a].subtitleLang.enable+" to "+g.state.players[a].subtitleLang.enable+", notifying view"),m("model.state.players."+a+".subtitleLang.enable")),c(d[a].teletextLang,g.state.players[a].teletextLang)&&(e.debug("WebApp.Controller: "+b(d,a,"teletextLang")+", notifying view"),m("model.state.players."+a+".teletextLang")),
c(d[a].window,g.state.players[a].window)&&(e.debug("WebApp.Controller: "+b(d,a,"window")+", notifying view"),m("model.state.players."+a+".window"))}else"channelTuned"==a[0]&&(e.debug("WebApp.Controller: channel tuned update received - player "+a[1]+", channel "+a[2]),d=a[1],void 0!=a[2]&&(g.state.players[d].source.idx=a[2],m("model.state.players."+d+".source","model.state.players."+d+".source")))};this.processLoadCallback=function(a){var b=a[0];a=a[1];return void 0===h[b]?(e.error("could not identify callback with key "+
callback-key),void 0):(h[b].apply(this,[a]),delete h[b],void 0)};var t=null;this.getApplicationIndex=function(a){if(null!=t)return t;for(var b=0;b<g.state.applications.length;b++)if(window.name===g.state.applications[b].windowId)return t=b,b;if(void 0!=a)return a;throw e.error("WebApp.Controller: app index queried, but no app with window name "+window.name+" currently stored in model"),Error("no app with window name "+window.name+" currently stored in model");}};
!function(g){function l(b,c,f,m){if(!f)return[];var g,k,q,a=[],d=c.length,n=c[m],e=c[m+1];if(m===d&&f._listeners){if("function"==typeof f._listeners)return b&&b.push(f._listeners),[f];c=0;for(m=f._listeners.length;m>c;c++)b&&b.push(f._listeners[c]);return[f]}if("*"===n||"**"===n||f[n]){if("*"===n){for(g in f)"_listeners"!==g&&f.hasOwnProperty(g)&&(a=a.concat(l(b,c,f[g],m+1)));return a}if("**"===n){(k=m+1===d||m+2===d&&"*"===e)&&f._listeners&&(a=a.concat(l(b,c,f,d)));for(g in f)"_listeners"!==g&&f.hasOwnProperty(g)&&
("*"===g||"**"===g?(f[g]._listeners&&!k&&(a=a.concat(l(b,c,f[g],d))),a=a.concat(l(b,c,f[g],m))):a=g===e?a.concat(l(b,c,f[g],m+2)):a.concat(l(b,c,f[g],m)));return a}a=a.concat(l(b,c,f[n],m+1))}if(k=f["*"],k&&l(b,c,k,m+1),f=f["**"])if(d>m)for(g in f._listeners&&l(b,c,f,d),f)"_listeners"!==g&&f.hasOwnProperty(g)&&(g===e?l(b,c,f[g],m+2):g===n?l(b,c,f[g],m+1):(q={},q[g]=f[g],l(b,c,{"**":q},m+1)));else f._listeners?l(b,c,f,d):f["*"]&&f["*"]._listeners&&l(b,c,f["*"],d);return a}var k=Array.isArray?Array.isArray:
function(b){return"[object Array]"===Object.prototype.toString.call(b)};WebApp.EventEmitter=function(b){this._events={};b&&(b.delimiter&&(this.delimiter=b.delimiter),b.wildcard&&(this.wildcard=b.wildcard),this.wildcard&&(this.listenerTree={}))};WebApp.EventEmitter.prototype.delimiter=".";WebApp.EventEmitter.prototype.setMaxListeners=function(b){this._events||(this._events={});this._events.maxListeners=b};WebApp.EventEmitter.prototype.event="";WebApp.EventEmitter.prototype.once=function(b,c){return this.many(b,
1,c),this};WebApp.EventEmitter.prototype.many=function(b,c,f){function g(){0===--c&&k.off(b,g);f.apply(this,arguments)}var k=this;if("function"!=typeof f)throw Error("many only accepts instances of Function");return g._origin=f,this.on(b,g),k};WebApp.EventEmitter.prototype.emit=function(){this._events||(this._events={});var b=arguments[0];if("newListener"===b&&!this._events.newListener)return!1;if(this._all){for(var c=arguments.length,f=Array(c-1),g=1;c>g;g++)f[g-1]=arguments[g];g=0;for(c=this._all.length;c>
g;g++)this.event=b,this._all[g].apply(this,f)}if("error"===b&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");var k;this.wildcard?(k=[],c="string"==typeof b?b.split(this.delimiter):b.slice(),l.call(this,k,c,this.listenerTree,0)):k=this._events[b];if("function"==typeof k){if(this.event=b,1===arguments.length)k.call(this);else if(1<arguments.length)switch(arguments.length){case 2:k.call(this,
arguments[1]);break;case 3:k.call(this,arguments[1],arguments[2]);break;default:c=arguments.length;f=Array(c-1);for(g=1;c>g;g++)f[g-1]=arguments[g];k.apply(this,f)}return!0}if(k){c=arguments.length;f=Array(c-1);for(g=1;c>g;g++)f[g-1]=arguments[g];k=k.slice();g=0;for(c=k.length;c>g;g++)this.event=b,k[g].apply(this,f);return 0<k.length||this._all}return this._all};WebApp.EventEmitter.prototype.on=function(b,c){if("function"==typeof b)return this.onAny(b),this;if("function"!=typeof c)throw Error("on only accepts instances of Function");
this._events||(this._events={});if(this.emit("newListener",b,c),this.wildcard){a:{for(var f=b,f="string"==typeof f?f.split(this.delimiter):f.slice(),g=0,l=f.length;l>g+1;g++)if("**"===f[g]&&"**"===f[g+1])break a;g=this.listenerTree;for(l=f.shift();l;){if(g[l]||(g[l]={}),g=g[l],0===f.length){g._listeners?"function"==typeof g._listeners?g._listeners=[g._listeners,c]:k(g._listeners)&&(g._listeners.push(c),!g._listeners.warned)&&(f=10,"undefined"!=typeof this._events.maxListeners&&(f=this._events.maxListeners),
0<f&&g._listeners.length>f&&(g._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",g._listeners.length),console.trace())):g._listeners=c;break a}l=f.shift()}}return this}this._events[b]?"function"==typeof this._events[b]?this._events[b]=[this._events[b],c]:k(this._events[b])&&(this._events[b].push(c),!this._events[b].warned)&&(f=10,"undefined"!=typeof this._events.maxListeners&&(f=this._events.maxListeners),
0<f&&this._events[b].length>f&&(this._events[b].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[b].length),console.trace())):this._events[b]=c;return this};WebApp.EventEmitter.prototype.onAny=function(b){if(this._all||(this._all=[]),"function"!=typeof b)throw Error("onAny only accepts instances of Function");return this._all.push(b),this};WebApp.EventEmitter.prototype.addListener=
WebApp.EventEmitter.prototype.on;WebApp.EventEmitter.prototype.off=function(b,c){if("function"!=typeof c)throw Error("removeListener only takes instances of Function");var f,g=[];if(this.wildcard)g="string"==typeof b?b.split(this.delimiter):b.slice(),g=l.call(this,null,g,this.listenerTree,0);else{if(!this._events[b])return this;f=this._events[b];g.push({_listeners:f})}for(var r=0;r<g.length;r++){var s=g[r];if(f=s._listeners,k(f)){for(var q=-1,a=0,d=f.length;d>a;a++)if(f[a]===c||f[a].listener&&f[a].listener===
c||f[a]._origin&&f[a]._origin===c){q=a;break}if(0>q)break;this.wildcard?s._listeners.splice(q,1):this._events[b].splice(q,1);0===f.length&&(this.wildcard?delete s._listeners:delete this._events[b])}else(f===c||f.listener&&f.listener===c||f._origin&&f._origin===c)&&(this.wildcard?delete s._listeners:delete this._events[b])}return this};WebApp.EventEmitter.prototype.offAny=function(b){var c,f=0,g=0;if(b&&this._all&&0<this._all.length)for(c=this._all,f=0,g=c.length;g>f;f++){if(b===c[f])return c.splice(f,
1),this}else this._all=[];return this};WebApp.EventEmitter.prototype.removeListener=WebApp.EventEmitter.prototype.off;WebApp.EventEmitter.prototype.removeAllListeners=function(b){if(0===arguments.length)return this._events&&(this._events={}),this;if(this.wildcard)for(var c="string"==typeof b?b.split(this.delimiter):b.slice(),c=l.call(this,null,c,this.listenerTree,0),f=0;f<c.length;f++)c[f]._listeners=null;else{if(!this._events[b])return this;this._events[b]=null}return this};WebApp.EventEmitter.prototype.listeners=
function(b){if(this.wildcard){var c=[];b="string"==typeof b?b.split(this.delimiter):b.slice();return l.call(this,c,b,this.listenerTree,0),c}this._events||(this._events={});return this._events[b]||(this._events[b]=[]),k(this._events[b])||(this._events[b]=[this._events[b]]),this._events[b]};WebApp.EventEmitter.prototype.listenersAny=function(){return this._all?this._all:[]};"function"==typeof define&&define.amd?define(function(){return WebApp.EventEmitter}):g.EventEmitter2=WebApp.EventEmitter}("undefined"!=
typeof process&&"undefined"!=typeof process.title&&"undefined"!=typeof exports?exports:"undefined"!=typeof window?window:null);
WebApp.Model=function(){var g=function(b,c){this.code=b;this.type=c},l=function(){this.applications=[];this.key=null;this.players=[]},k=function(b,c,f){this.id=b;this.sourceId=c;this.method=f;this.message={}};this.State=l;this.Application=function(b,c,f,g,l,s,q,a,d,n,e,h){this.id=b;this.name=c;this.shortSynopsis=f;this.isAdult=g;this.isViewable=l;this.isEntitled=s;this.products=[];this.pictures=[];this.url=q;this.inFocus=a;this.windowId=d;this.viewState=n;this.state=e;this.type=h;this.appMsg=new k;
this.reservedKeys=[];this.appKeys=[];this.modelSets=[];this.media={assets:[]}};this.Player=function(b,c,f,k,l,s,q,a){this.currentChannel=this.source=b;this.playRate=c;this.position=f;this.window=k;this.zIndex=l;this.duration=s;this.status=null;this.availAudioLangs=[];this.availSubtitleLangs=[];this.audioLang=new g(q,a);this.subtitleLang=new g(q,a);this.teletextLang=new g(q,a);this.restricted=this.mapLoc=null;this.isBlocked=!1};this.channels=[];this.state=new l;this.Channel=function(b,c,f,g,k,l,q){this.idx=
b;this.id=c;this.locator=f;this.lcn=g;this.name=k;this.pictures=l;this.viewable=q;this.isFav=!1;this.plcn=0};this.keymap=new function(){this.VK_EXIT=3;this.VK_BACK_SPACE=8;this.VK_ENTER=this.VK_OK=13;this.VK_KEYBOARD=16;this.VK_ACCEPT=30;this.VK_SPACE=32;this.VK_PAGE_UP=33;this.VK_PAGE_DOWN=34;this.VK_HOME=36;this.VK_LEFT=37;this.VK_UP=38;this.VK_RIGHT=39;this.VK_DOWN=40;this.VK_0=48;this.VK_1=49;this.VK_2=50;this.VK_3=51;this.VK_4=52;this.VK_5=53;this.VK_6=54;this.VK_7=55;this.VK_8=56;this.VK_9=
57;this.VK_A=65;this.VK_B=66;this.VK_C=67;this.VK_D=68;this.VK_E=69;this.VK_F=70;this.VK_G=71;this.VK_H=72;this.VK_I=73;this.VK_J=74;this.VK_K=75;this.VK_L=76;this.VK_M=77;this.VK_N=78;this.VK_O=79;this.VK_P=80;this.VK_Q=81;this.VK_R=82;this.VK_S=83;this.VK_T=84;this.VK_U=85;this.VK_V=86;this.VK_W=87;this.VK_X=88;this.VK_Y=89;this.VK_Z=90;this.VK_RED=403;this.VK_GREEN=404;this.VK_BLUE=406;this.VK_YELLOW=405;this.VK_DELETE=127;this.VK_HELP=156;this.VK_POWER=409;this.VK_CHANNEL_UP=427;this.VK_CHANNEL_DOWN=
428;this.VK_VOLUME_UP=447;this.VK_VOLUME_DOWN=448;this.VK_MUTE=449;this.VK_INFO=457;this.VK_GUIDE=458;this.VK_BACK=461;this.VK_MENU=462;this.VK_PAUSE=19;this.VK_REW=412;this.VK_STOP=413;this.VK_PLAY=415;this.VK_REC=416;this.VK_FF=417;this.VK_REW_SKIP=424;this.VK_FWD_SKIP=425;this.VK_FAV=433;this.VK_TELETEXT=459;this.VK_SUBTITLE=460};this.MediaAsset=function(b,c,f,g,k,l,q,a,d,n,e,h,v){this.id=b;this.name=c;this.URL=f;this.picture=g;this.type=k;this.mimeType=l;this.encoding=q;this.description=a;this.genre=
d;this.date=n;this.size=e;this.duration=h;this.ageRating=v};this.AnnouncementEvent=function(b,c,f,g,k){this.type=b;this.time=c;this.message=f;this.imageURL=g;this.timeout=k};this.Announcement=function(b,c,f,g,k){this.event=b;this.id=c;this.name=f;this.image=g;this.url=k}};